<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNMP Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: #e5e7eb; /* text-gray-200 */
        }
        #log-output::-webkit-scrollbar {
            width: 8px;
        }
        #log-output::-webkit-scrollbar-track {
            background: #1f2937; /* bg-gray-800 */
        }
        #log-output::-webkit-scrollbar-thumb {
            background: #4b5563; /* bg-gray-600 */
            border-radius: 4px;
        }
        #log-output::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* bg-gray-500 */
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* --- Animations --- */
        @keyframes vibrate {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }
        .vibrate {
            animation: vibrate 0.3s linear 2; /* Run animation twice */
        }

        /* --- Modal Styles --- */
        .modal-backdrop {
            transition: opacity 0.3s ease-in-out;
        }
        .modal-content {
            transition: transform 0.3s ease-in-out;
            max-height: 80vh; /* Ensure modal content is scrollable on small screens */
        }
    </style>
</head>
<body class="bg-black text-gray-100 min-h-screen p-4 sm:p-8">

    <div class="max-w-7xl mx-auto mb-4 flex justify-end gap-3">
        <button id="learn-btn" class="bg-gray-700 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition duration-200 shadow-md">
            Learn
        </button>
        <button id="developed-by-btn" class="bg-gray-700 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition duration-200 shadow-md">
            Developed by
        </button>
        <button id="help-btn" class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-4 rounded-lg transition duration-200 shadow-md">
            Help
        </button>
    </div>
    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-8 text-blue-400">SNMP Simulator</h1>

        <div class="flex flex-col lg:flex-row gap-8">

            <div class="lg:w-1/3 bg-gray-900 p-6 rounded-lg shadow-xl space-y-8">
                
                <div class="space-y-4">
                    <h2 class="text-xl font-semibold text-blue-300 border-b border-gray-700 pb-2">1. Device Setup</h2>
                    <div>
                        <label for="num-devices" class="block text-sm font-medium text-gray-300">Number of Devices</label>
                        <input type="number" id="num-devices" value="5" class="mt-1 block w-full bg-gray-800 border-gray-700 rounded-md shadow-sm p-2 text-gray-100 focus:ring-blue-400 focus:border-blue-400">
                    </div>
                    <div>
                        <label for="manager-ip" class="block text-sm font-medium text-gray-300">Manager IP</label>
                        <input type="text" id="manager-ip" value="192.168.1.1" class="mt-1 block w-full bg-gray-800 border-gray-700 rounded-md shadow-sm p-2 text-gray-100 focus:ring-blue-400 focus:border-blue-400">
                    </div>
                    <div>
                        <label for="agent-prefix" class="block text-sm font-medium text-gray-300">Agent IP Prefix</label>
                        <input type="text" id="agent-prefix" value="192.168.1." class="mt-1 block w-full bg-gray-800 border-gray-700 rounded-md shadow-sm p-2 text-gray-100 focus:ring-blue-400 focus:border-blue-400">
                    </div>
                    <button id="start-sim-btn" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-4 rounded-lg transition duration-200 shadow-md">Start Simulation</button>
                </div>

                <div class="space-y-4">
                    <h2 class="text-xl font-semibold text-blue-300 border-b border-gray-700 pb-2">2. Polling Configuration</h2>
                    <div>
                        <label for="oids-to-poll" class="block text-sm font-medium text-gray-300">OIDs to Poll (one per line)</label>
                        <textarea id="oids-to-poll" rows="4" class="mt-1 block w-full bg-gray-800 border-gray-700 rounded-md shadow-sm p-2 text-gray-100 focus:ring-blue-400 focus:border-blue-400">1.3.6.1.2.1.1.1.0
1.3.6.1.2.1.1.3.0
1.3.6.1.2.1.2.2.1.8.1
1.3.6.1.2.1.2.2.1.8.2</textarea>
                    </div>
                    <div>
                        <label for="poll-interval" class="block text-sm font-medium text-gray-300">Polling Interval (ms)</label>
                        <input type="number" id="poll-interval" value="5000" class="mt-1 block w-full bg-gray-800 border-gray-700 rounded-md shadow-sm p-2 text-gray-100 focus:ring-blue-400 focus:border-blue-400">
                    </div>
                    <div>
                        <label for="net-delay" class="block text-sm font-medium text-gray-300">Network Delay (ms)</label>
                        <input type="number" id="net-delay" value="150" class="mt-1 block w-full bg-gray-800 border-gray-700 rounded-md shadow-sm p-2 text-gray-100 focus:ring-blue-400 focus:border-blue-400">
                    </div>
                    <button id="start-poll-btn" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded-lg transition duration-200 shadow-md" disabled>Start Polling</button>
                    <button id="stop-poll-btn" class="w-full bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-4 rounded-lg transition duration-200 shadow-md" disabled>Stop Polling</button>
                </div>

                <div class="space-y-4">
                    <h2 class="text-xl font-semibold text-blue-300 border-b border-gray-700 pb-2">3. Manual SET Operation</h2>
                    <div>
                        <label for="set-ip" class="block text-sm font-medium text-gray-300">Device IP</label>
                        <input type="text" id="set-ip" placeholder="e.g., 192.168.1.101" class="mt-1 block w-full bg-gray-800 border-gray-700 rounded-md shadow-sm p-2 text-gray-100 focus:ring-blue-400 focus:border-blue-400">
                    </div>
                    <div>
                        <label for="set-oid" class="block text-sm font-medium text-gray-300">OID to SET</label>
                        <input type="text" id="set-oid" value="1.3.6.1.2.1.1.5.0" class="mt-1 block w-full bg-gray-800 border-gray-700 rounded-md shadow-sm p-2 text-gray-100 focus:ring-blue-400 focus:border-blue-400">
                    </div>
                    <div>
                        <label for="set-value" class="block text-sm font-medium text-gray-300">New Value</label>
                        <input type="text" id="set-value" placeholder="e.g., 'new-router-name'" class="mt-1 block w-full bg-gray-800 border-gray-700 rounded-md shadow-sm p-2 text-gray-100 focus:ring-blue-400 focus:border-blue-400">
                    </div>
                    <button id="send-set-btn" class="w-full bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-bold py-2 px-4 rounded-lg transition duration-200 shadow-md" disabled>Send SET Request</button>
                </div>
            </div>

            <div class="lg:w-2/3 space-y-8">
                
                <div>
                    <h2 class="text-2xl font-semibold text-blue-300 mb-4">Network Map</h2>
                    <div id="network-map" class="bg-gray-900 p-6 rounded-lg shadow-xl flex items-center justify-center min-h-[400px] relative">
                        
                        <div id="map-manager" class="transition-all duration-150 z-10">
                            </div>
                        
                        <div id="map-agents-container" class="absolute top-0 left-0 w-full h-full">
                             <div class="text-gray-400 italic absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">
                                 Press "Start Simulation" to create devices.
                             </div>
                        </div>
                    </div>
                </div>

                <div>
                    <h2 class="text-2xl font-semibold text-blue-300 mb-4">Device Status</h2>
                    <div id="device-status-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                        <div class="text-gray-400 italic">Press "Start Simulation" to create devices.</div>
                    </div>
                </div>

                <div>
                    <h2 class="text-2xl font-semibold text-blue-300 mb-4">SNMP Log</h2>
                    <pre id="log-output" class="w-full h-96 bg-gray-800 text-sm text-gray-100 rounded-lg shadow-inner p-4 overflow-y-scroll font-mono"></pre>
                    <button id="clear-log-btn" class="mt-4 bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg transition duration-200 shadow-md">Clear Log</button>
                </div>
            </div>
        </div>
    </div>

    <div id="help-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="modal-backdrop absolute inset-0 bg-black bg-opacity-75" data-close-modal="help-modal"></div>
        <div class="modal-content bg-gray-900 rounded-lg shadow-xl w-full max-w-3xl transform scale-95 z-10 p-6 overflow-y-auto">
            <div class="flex items-center justify-between border-b border-gray-700 pb-3 mb-4">
                <h2 class="text-2xl font-semibold text-blue-300">Help - How to Use the Simulator</h2>
                <button data-close-modal="help-modal" class="text-gray-400 hover:text-white text-3xl">&times;</button>
            </div>
            <div class="space-y-4 text-gray-300">
                <p>This simulator demonstrates the core concepts of SNMP (Simple Network Management Protocol). Here's the correct flow to use it:</p>
                
                <h3 class="text-xl font-semibold text-blue-300">1. Start the Simulation</h3>
                <ul class="list-disc list-inside space-y-2 pl-4">
                    <li><strong>Number of Devices:</strong> Enter how many simulated devices (Routers/Switches) you want to create (e.g., 5).</li>
                    <li><strong>Manager IP:</strong> Set the IP address for the central Network Manager (e.g., 192.168.1.1).</li>
                    <li><strong>Agent IP Prefix:</strong> Set the base IP for your devices (e.g., 192.168.1.). The simulator will create devices with IPs like 192.168.1.101, 192.168.1.102, etc.</li>
                    <li>Click <strong>"Start Simulation"</strong>. You will see the devices appear on the Network Map and in the Device Status grid.</li>
                </ul>

                <h3 class="text-xl font-semibold text-blue-300">2. Start Polling (GET Requests)</h3>
                <ul class="list-disc list-inside space-y-2 pl-4">
                    <li><strong>OIDs to Poll:</strong> These are the "questions" the manager will ask each device. The defaults check for system description, uptime, and port status.</li>
                    <li><strong>Polling Interval:</strong> How often to ask (in milliseconds). 5000ms = 5 seconds.</li>
                    <li><strong>Network Delay:</strong> Simulates network lag for requests and responses.</li>
                    <li>Click <strong>"Start Polling"</strong>. Watch the "SNMP Log" - you'll see [GET] requests going from the Manager to the agents and [GET-RESPONSE] replies coming back. The Network Map will flash blue for each poll.</li>
                </ul>

                <h3 class="text-xl font-semibold text-blue-300">3. Interpret the Results</h3>
                <ul class="list-disc list-inside space-y-2 pl-4">
                    <li><strong>SNMP Log:</strong> This is the main output.
                        <ul>
                            <li><span class="text-blue-400">[GET]</span>: The manager asking for data.</li>
                            <li><span class="text-yellow-400">[SET]</span>: The manager telling a device to change something.</li>
                            <li><span class="text-red-400">[TRAP]</span>: A device automatically reporting an important event (like a port going down). The map node will turn red and vibrate.</li>
                        </ul>
                    </li>
                    <li><strong>Network Map:</strong>
                        <ul>
                            <li><strong>Blue Flash:</strong> A device is being polled (GET/SET).</li>
                            <li><strong>Red Node:</strong> A device has sent a TRAP (an alert). It resets to its normal color (blue/green) on the next successful poll.</li>
                        </ul>
                    </li>
                     <li><strong>Device Status:</strong> You can click on any device in this grid to print its entire MIB (its database of information) to the log.</li>
                </ul>
                
                <h3 class="text-xl font-semibold text-blue-300">4. Send a Manual SET Request</h3>
                <ul class="list-disc list-inside space-y-2 pl-4">
                    <li>This lets you manually change data on a device.</li>
                    <li><strong>Device IP:</strong> Enter the *exact* IP of a device (e.g., 192.168.1.101).</li>
                    <li><strong>OID to SET:</strong> Enter an OID that is writable. Try `1.3.6.1.2.1.1.5.0` (the device name).</li>
                    <li><strong>New Value:</strong> Enter the new name (e.g., "Main-Router-Floor1").</li>
                    <li>Click <strong>"Send SET Request"</strong>. You'll see the [SET] request and [SET-RESPONSE] in the log. The map will flash yellow.</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="learn-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="modal-backdrop absolute inset-0 bg-black bg-opacity-75" data-close-modal="learn-modal"></div>
        <div class="modal-content bg-gray-900 rounded-lg shadow-xl w-full max-w-3xl transform scale-95 z-10 p-6 overflow-y-auto">
            <div class="flex items-center justify-between border-b border-gray-700 pb-3 mb-4">
                <h2 class="text-2xl font-semibold text-blue-300">Project Learning Center</h2>
                <button data-close-modal="learn-modal" class="text-gray-400 hover:text-white text-3xl">&times;</button>
            </div>
            <div class="space-y-6 text-gray-300">
                
                <div>
                    <h3 class="text-xl font-semibold text-blue-300 mb-2">How We Built This Project</h3>
                    <p>This project is a lightweight, front-end-only network simulator built with pure <strong>HTML, JavaScript, and Tailwind CSS</strong>. It runs entirely in your browser without any backend server.</p>
                    <ul class="list-disc list-inside space-y-1 pl-4 mt-2">
                        <li><strong>JavaScript Classes:</strong> A `Device` class is used to create simulated router and switch objects. Each object maintains its own "MIB" (a JavaScript `Map` or `Object`) to store data.</li>
                        <li><strong>Event-Driven Logic:</strong> All actions are triggered by button clicks. `setInterval` is used for the "Start Polling" loop. `setTimeout` is used to simulate network latency.</li>
                        <li><strong>DOM Manipulation:</strong> The Network Map, Device Grid, and SNMP Log are all dynamically generated by JavaScript functions that create, add, and remove HTML elements.</li>
                        <li><strong>CSS Animations:</strong> The flashing and vibrating effects on the map are done with CSS `keyframes` and by dynamically adding/removing CSS classes with JavaScript.</li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-xl font-semibold text-blue-300 mb-2">Materials (from Prescribed Text Book)</h3>
                    <p class="italic">[This is a placeholder. You should replace this text with relevant theory, diagrams, and notes from your textbook. For example, you could explain the SNMP protocol structure (Manager, Agent, MIB, OID) or the different PDU types (GET, SET, TRAP).]</p>
                    <p class="mt-2"><strong>Key Concepts:</strong></p>
                    <ul class="list-disc list-inside space-y-1 pl-4">
                        <li><strong>Manager:</strong> The console (this webpage) that monitors the network.</li>
                        <li><strong>Agent:</strong> The software running on the simulated devices (Routers/Switches).</li>
                        <li><strong>MIB (Management Information Base):</strong> A hierarchical database of information on an agent. We simulate this with a JavaScript object.</li>
                        <li><strong>OID (Object Identifier):</strong> A unique, dot-separated address for a piece of data in the MIB (e.g., `1.3.6.1.2.1.1.1.0` for System Description).</li>
                    </ul>
                </div>

                <div>
                    <h3 class="text-xl font-semibold text-blue-300 mb-2">Reference Video</h3>
                    <p>An overview of the SNMP protocol.</p>
                    <div class="aspect-w-16 aspect-h-9 bg-gray-800 rounded-lg mt-2">
                        <iframe width="100%" height="315" src="https://www.youtube.com/embed/Keyf_P_hF3A" 
                                title="YouTube video player" frameborder="0" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen class="rounded-lg">
                        </iframe>
                    </div>
                </div>

                <div>
                    <h3 class="text-xl font-semibold text-blue-300 mb-2">References</h3>
                     <ul class="list-disc list-inside space-y-1 pl-4 text-sm">
                        <li><a href="https://docs.lextudio.com/snmpsim/" target="_blank" class="text-blue-400 hover:underline">SNMP Simulator Documentation</a></li>
                        <li><a href="https://www.easysnmp.com/downloads/easysnmp-fundamentals-second-edition.pdf" target="_blank" class="text-blue-400 hover:underline">EasySNMP Fundamentals (PDF)</a></li>
                        <li><a href="https://tailwindcss.com/" target="_blank" class="text-blue-400 hover:underline">Tailwind CSS Documentation</a></li>
                        <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript" target="_blank" class="text-blue-400 hover:underline">MDN Web Docs (JavaScript)</a></li>
                     </ul>
                </div>

            </div>
        </div>
    </div>

    <div id="developed-by-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="modal-backdrop absolute inset-0 bg-black bg-opacity-75" data-close-modal="developed-by-modal"></div>
        <div class="modal-content bg-gray-900 rounded-lg shadow-xl w-full max-w-3xl transform scale-95 z-10 p-6 overflow-y-auto">
            <div class="flex items-center justify-between border-b border-gray-700 pb-3 mb-4">
                <h2 class="text-2xl font-semibold text-blue-300">Developed By</h2>
                <button data-close-modal="developed-by-modal" class="text-gray-400 hover:text-white text-3xl">&times;</button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                
                <div class="bg-gray-800 p-4 rounded-lg shadow-lg">
                    <img id="photo-harshit" src="images/harshit.jpg" alt="Photo of Harshit Tiwari" 
                         class="w-32 h-32 rounded-full mx-auto mb-3 bg-gray-700 object-cover border-2 border-blue-400"
                         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI2EwYTBiYyI+PHBhdGggZD0iTTEyIDJDNi40OCAyIDIgNi40OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bTAgM2MxLjY2IDAgMyAxLjM0IDMgM3MtMS4zNCAzLTMgMy0zLTEuMzQtMy0zIDEuMzQtMyAzLTN6bTAgMTRjLTIuNjcgMC01LjAxLTEuNDQtNi4zMy0zLjY5QzcuNTYgMTMuODEgOS42OCAxMyAxMiAxM3MyLjQ0LjgyIDQuMzMgMi4zMUMxNy4wMSA5LjU2IDE0LjY3IDE5IDEyIDE5eiIvPjwvc3ZnPg=='; this.onerror=null;">
                    <h3 class="text-xl font-semibold text-white">Harshit Tiwari</h3>
                    <p class="text-blue-300">24BCE1363</p>
                </div>

                <div class="bg-gray-800 p-4 rounded-lg shadow-lg">
                    <img id="photo-nityanshu" src="images/kushagra.jpg" alt="Photo of Nityanshu Tripathi" 
                         class="w-32 h-32 rounded-full mx-auto mb-3 bg-gray-700 object-cover border-2 border-blue-400"
                         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI2EwYTBiYyI+PHBhdGggZD0iTTEyIDJDNi40OCAyIDIgNi44OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bTAgM2MxLjY2IDAgMyAxLjM0IDMgM3MtMS4zNCAzLTMgMy0zLTEuMzQtMy0zIDEuMzQtMyAzLTN6bTAgMTRjLTIuNjcgMC01LjAxLTEuNDQtNi4zMy0zLjY5QzcuNTYgMTMuODEgOS42OCAxMyAxMiAxM3MyLjQ0LjgyIDQuMzMgMi4zMUMxNy4wMSA5LjU2IDE0LjY3IDE5IDEyIDE5eiIvPjwvc3ZnPg=='; this.onerror=null;">
                    <h3 class="text-xl font-semibold text-white">Nityanshu Tripathi</h3>
                    <p class="text-blue-300">24BCE1340</p>
                </div>

                <div class="bg-gray-800 p-4 rounded-lg shadow-lg">
                    <img id="photo-kushagra" src="images/nityanshu.jpg" alt="Photo of Kushagra Shrivastava" 
                         class="w-32 h-32 rounded-full mx-auto mb-3 bg-gray-700 object-cover border-2 border-blue-400"
                         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI2EwYTBiYyI+PHBhdGggZD0iTTEyIDJDNi40OCAyIDIgNi44OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bTAgM2MxLjY2IDAgMyAxLjM0IDMgM3MtMS4zNCAzLTMgMy0zLTEuMzQtMy0zIDEuMzQtMyAzLTN6bTAgMTRjLTIuNjcgMC01LjExLTEuNDQtNi4zMy0zLjY5QzcuNTYgMTMuODEgOS42OCAxMyAxMiAxM3MyLjQ0LjgyIDQuMzMgMi4zMUMxNy4wMSA5LjU2IDE0LjY3IDE5IDEyIDE5eiIvPjwvc3ZnPg=='; this.onerror=null;">
                    <h3 class="text-xl font-semibold text-white">Kushagra Shrivastava</h3>
                    <p class="text-blue-300">24BCE1344</p>
                </div>

            </div>
        </div>
    </div>


    <script>
        // ============================================
        // =========== NEW MODAL JAVASCRIPT ===========
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            const modalTriggers = {
                'help-btn': 'help-modal',
                'learn-btn': 'learn-modal',
                'developed-by-btn': 'developed-by-modal',
            };

            const allModals = document.querySelectorAll('#help-modal, #learn-modal, #developed-by-modal');

            // Function to open a modal
            const openModal = (modalId) => {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.remove('hidden');
                    // Animate entry
                    setTimeout(() => {
                        modal.querySelector('.modal-backdrop').classList.remove('opacity-0');
                        modal.querySelector('.modal-content').classList.remove('scale-95');
                        modal.querySelector('.modal-content').classList.add('scale-100');
                    }, 10);
                }
            };

            // Function to close a modal
            const closeModal = (modalId) => {
                const modal = document.getElementById(modalId);
                if (modal) {
                    // Animate exit
                    modal.querySelector('.modal-backdrop').classList.add('opacity-0');
                    modal.querySelector('.modal-content').classList.remove('scale-100');
                    modal.querySelector('.modal-content').classList.add('scale-95');
                    setTimeout(() => {
                        modal.classList.add('hidden');
                    }, 300); // Wait for animation to finish
                }
            };

            // Attach listeners to open buttons
            for (const [btnId, modalId] of Object.entries(modalTriggers)) {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', () => openModal(modalId));
                }
            }

            // Attach listeners to close buttons and backdrops
            allModals.forEach(modal => {
                modal.querySelectorAll('[data-close-modal]').forEach(element => {
                    element.addEventListener('click', () => {
                        closeModal(element.dataset.closeModal);
                    });
                });
            });

            // Optional: Close modal on Escape key press
            document.addEventListener('keydown', (e) => {
                if (e.key === "Escape") {
                    allModals.forEach(modal => {
                        if (!modal.classList.contains('hidden')) {
                            closeModal(modal.id);
                        }
                    });
                }
            });
        });


        // ==============================================
        // =========== ORIGINAL SNMP SIM SCRIPT ===========
        // ==============================================

        const devices = new Map();
        let managerIP = '';
        let pollingIntervalId = null;

        // --- Control Panel Elements ---
        const startSimBtn = document.getElementById('start-sim-btn');
        const startPollBtn = document.getElementById('start-poll-btn');
        const stopPollBtn = document.getElementById('stop-poll-btn');
        const sendSetBtn = document.getElementById('send-set-btn');
        const clearLogBtn = document.getElementById('clear-log-btn');
        const numDevicesInput = document.getElementById('num-devices');
        const managerIpInput = document.getElementById('manager-ip');
        const agentPrefixInput = document.getElementById('agent-prefix');
        const oidsTextarea = document.getElementById('oids-to-poll');
        const pollIntervalInput = document.getElementById('poll-interval');
        const netDelayInput = document.getElementById('net-delay');
        const setIpInput = document.getElementById('set-ip');
        const setOidInput = document.getElementById('set-oid');
        const setValueInput = document.getElementById('set-value');
        
        // --- Display Panel Elements ---
        const deviceGrid = document.getElementById('device-status-grid');
        const logOutput = document.getElementById('log-output');
        const networkMap = document.getElementById('network-map');
        const mapManager = document.getElementById('map-manager');
        const mapAgentsContainer = document.getElementById('map-agents-container');

        // --- Device Class ---
        class Device {
            constructor(ip, type) {
                this.ip = ip;
                this.type = type;
                this.startTime = Date.now();
                this.mib = this.generateSimulatedMib();
                
                this.portStatus = {
                    '1.3.6.1.2.1.2.2.1.8.1': 'up',
                    '1.3.6.1.2.1.2.2.1.8.2': 'up',
                };
            }

            generateSimulatedMib() {
                const deviceId = this.ip.split('.').pop();
                return {
                    '1.3.6.1.2.1.1.1.0': `Simulated ${this.type} v${deviceId}.0`,
                    '1.3.6.1.2.1.1.2.0': '1.3.6.1.4.1.9999',
                    '1.3.6.1.2.1.1.3.0': () => (Date.now() - this.startTime) / 10,
                    '1.3.6.1.2.1.1.5.0': `${this.type.toLowerCase()}-${deviceId}`,
                    '1.3.6.1.2.1.1.6.0': 'Data Center, 1st Floor',
                };
            }

            get(oid) {
                if (this.mib[oid] && typeof this.mib[oid] === 'function') {
                    return Math.floor(this.mib[oid]());
                }
                
                if (this.portStatus.hasOwnProperty(oid)) {
                    return this.portStatus[oid];
                }

                if (this.mib.hasOwnProperty(oid)) {
                    return this.mib[oid];
                }

                return 'Error: No Such Object';
            }

            set(oid, value) {
                const writableOids = ['1.3.6.1.2.1.1.5.0', '1.3.6.1.2.1.1.6.0'];

                if (writableOids.includes(oid)) {
                    this.mib[oid] = value;
                    return 'SET OK';
                }

                return 'Error: OID is read-only or does not exist';
            }

            simulateTrap() {
                if (Math.random() < 0.1) {
                    const portOid = '1.3.6.1.2.1.2.2.1.8.2';
                    const oldStatus = this.portStatus[portOid];
                    const newStatus = oldStatus === 'up' ? 'down' : 'up';
                    this.portStatus[portOid] = newStatus;

                    return {
                        type: 'TRAP',
                        source: this.ip,
                        oid: '1.3.6.1.6.3.1.1.5.3',
                        message: `Port 2 (OID: ${portOid}) changed status to ${newStatus}`
                    };
                }
                return null;
            }
        }

        // --- Logging Function ---
        function logMessage(type, source, dest, content) {
            const timestamp = new Date().toISOString();
            let colorClass = 'text-gray-200';
            
            if (type.startsWith('GET')) colorClass = 'text-blue-400';
            if (type.startsWith('SET')) colorClass = 'text-yellow-400';
            if (type.startsWith('TRAP')) colorClass = 'text-red-400 font-bold';
            if (type.startsWith('SYSTEM')) colorClass = 'text-green-400 font-bold';

            const logEntry = document.createElement('div');
            logEntry.innerHTML = 
                `<span class="text-gray-500">[${timestamp}]</span> ` +
                `<span class="w-24 inline-block ${colorClass}">[${type}]</span> ` +
                `<span class="text-cyan-400">From:</span> ${source} ` +
                `<span class="text-cyan-400">To:</span> ${dest} | ` +
                `<span class="${colorClass}">${content}</span>`;
            
            logOutput.prepend(logEntry);
        }

        // --- Network Delay ---
        function getNetworkDelay() {
            const delay = parseInt(netDelayInput.value, 10);
            return isNaN(delay) || delay < 0 ? 0 : delay;
        }

        // --- Network Map Animation ---
        function flashMapElement(agentIp, type) {
            const managerEl = mapManager;
            const agentEl = document.getElementById(`map-agent-${agentIp}`);
            if (!agentEl) return;

            const managerBaseClass = mapManager.baseClass; 
            const agentBaseClass = agentEl.baseClass; 
            
            let flashClass = '';
            let vibrateClass = '';

            switch (type) {
                case 'get': 
                    flashClass = 'bg-blue-500 scale-110'; 
                    break;
                case 'set': 
                    flashClass = 'bg-yellow-500 scale-110 text-black'; 
                    break;
                case 'trap': 
                    flashClass = 'bg-red-600 border-red-400'; // Trap state class
                    vibrateClass = 'vibrate'; 
                    break;
                default: return;
            }

            const flashDuration = 150;

            if (type === 'get' || type === 'set') {
                // Request: Manager -> Agent
                managerEl.className = `${managerBaseClass} ${flashClass}`;
                setTimeout(() => {
                    managerEl.className = managerBaseClass;
                    agentEl.className = `${agentBaseClass} ${flashClass}`;
                    setTimeout(() => {
                        // Revert agent to base class *unless* it's in a trap state
                        if (!agentEl.className.includes('bg-red-600')) {
                           agentEl.className = agentBaseClass;
                        }
                    }, flashDuration);
                }, flashDuration);
            } else if (type === 'trap') {
                // Trap: Agent -> Manager
                // Agent turns red and vibrates, AND STAYS RED
                agentEl.className = `${agentBaseClass} ${flashClass} ${vibrateClass}`;
                
                // Manager flashes (border) and vibrates, then reverts
                // NEW: Make manager flash red completely, not just border
                managerEl.className = `${managerBaseFClass} bg-red-600 text-white border-red-400 ${vibrateClass}`;
                
                setTimeout(() => {
                    // Revert manager after animation
                    managerEl.className = managerBaseClass;
                    // DO NOT revert agentEl. It stays red.
                    // Remove vibrate class from agent after animation
                    agentEl.className = `${agentBaseClass} ${flashClass}`;
                }, 600); // Vibrate duration
            }
        }

        // --- UI Update Functions ---
        function updateDeviceGrid(device) {
            const card = document.createElement('div');
            // Changed to match new dark theme
            card.className = 'bg-gray-900 p-3 rounded-lg shadow-md cursor-pointer hover:bg-gray-800 transition duration-150 border border-gray-700';
            card.innerHTML = `
                <div class="font-bold text-blue-400">${device.ip}</div>
                <div class="text-sm text-gray-400">${device.type}</div>
            `;
            // Click to log MIB
            card.onclick = () => {
                logMessage('SYSTEM', 'Manager', 'Manager', `--- MIB for ${device.ip} ---`);
                for (const [oid, value] of Object.entries(device.mib)) {
                    const val = typeof value === 'function' ? Math.floor(value()) : value;
                    logMessage('SYSTEM', 'Manager', 'Manager', `${oid} = ${val}`);
                }
                for (const [oid, status] of Object.entries(device.portStatus)) {
                    logMessage('SYSTEM', 'Manager', 'Manager', `${oid} = ${status}`);
                }
                logMessage('SYSTEM', 'Manager', 'Manager', `--- End MIB ---`);
            };
            deviceGrid.appendChild(card);
        }

        // This function now places agents in a circle around the center
        function updateNetworkMap(device, index, total) {
            const mapAgentEl = document.createElement('div');
            const isRouter = device.type === 'Router';
            
            // Define classes for circle and colors
            const agentTypeClass = isRouter 
                ? 'bg-blue-800 border-blue-500' 
                : 'bg-green-800 border-green-500';
            
            // Store baseClass on the element for animation reset. NO pulse class.
            mapAgentEl.baseClass = `w-20 h-20 rounded-full flex flex-col items-center justify-center text-center shadow-lg transition-all duration-150 border-2 ${agentTypeClass}`;
            mapAgentEl.className = mapAgentEl.baseClass;
            mapAgentEl.id = `map-agent-${device.ip}`; // Set ID for flashing
            mapAgentEl.innerHTML = `
                <div class="font-semibold text-sm text-gray-100">${device.ip.split('.').pop()}</div>
                <div class="text-xs text-gray-300">${device.type}</div>
            `;

            // --- Circular Positioning Logic ---
            const radius = 160; // Radius of the circle in pixels
            // Calculate angle. Subtract PI/2 to start at the top (12 o'clock)
            const angle = (index / total) * 2 * Math.PI - (Math.PI / 2); 
            const x = Math.cos(angle) * radius;
            const y = Math.sin(angle) * radius;

            // Set new positioning
            mapAgentEl.style.position = 'absolute';
            mapAgentEl.style.top = '50%';
            mapAgentEl.style.left = '50%';
            // translate(-50%, -50%) centers the element *then* translate(x, y) moves it
            mapAgentEl.style.transform = `translate(-50%, -50%) translate(${x}px, ${y}px)`;
            // --- End Positioning Logic ---

            mapAgentsContainer.appendChild(mapAgentEl);
        }

        // --- Simulation Logic ---
        function pollDevice(device, oid) {
            // --- NEW RESET LOGIC ---
            // Find the map element for this device
            const agentEl = document.getElementById(`map-agent-${device.ip}`);
            // If the element exists and is NOT in its base state (i.e., it's red from a trap)
            if (agentEl && agentEl.className !== agentEl.baseClass) {
                // Reset it to its base state (blue/green)
                agentEl.className = agentEl.baseClass;
            }
            // --- END NEW LOGIC ---

            const delay = getNetworkDelay();
            logMessage('GET', managerIP, device.ip, `Query: ${oid}`);
            flashMapElement(device.ip, 'get'); // Animate map for the new GET

            setTimeout(() => {
                const value = device.get(oid);
                logMessage('GET-RESPONSE', device.ip, managerIP, `OID: ${oid} = ${value}`);
            }, delay);
        }

        function startPolling() {
            if (pollingIntervalId) clearInterval(pollingIntervalId);

            const interval = parseInt(pollIntervalInput.value, 10);
            if (isNaN(interval) || interval < 500) {
                logMessage('SYSTEM', 'Manager', 'Manager', 'Error: Invalid polling interval. Must be >= 500ms.');
                return;
            }

            const oidsToPoll = oidsTextarea.value.split('\n').map(o => o.trim()).filter(o => o);
            if (oidsToPoll.length === 0) {
                logMessage('SYSTEM', 'Manager', 'Manager', 'Error: No OIDs specified to poll.');
                return;
            }

            logMessage('SYSTEM', 'Manager', 'Manager', `Starting polling every ${interval}ms...`);
            stopPollBtn.disabled = false;
            startPollBtn.disabled = true;
            startPollBtn.innerText = "Polling...";

            pollingIntervalId = setInterval(() => {
                for (const [ip, device] of devices.entries()) {
                    for (const oid of oidsToPoll) {
                        pollDevice(device, oid);
                    }
                    const trap = device.simulateTrap();
                    if (trap) {
                        logMessage(trap.type, trap.source, managerIP, trap.message);
                        flashMapElement(trap.source, 'trap'); // Animate trap
                    }
                }
            }, interval);
        }

        function stopPolling() {
            if (pollingIntervalId) {
                clearInterval(pollingIntervalId);
                pollingIntervalId = null;
                logMessage('SYSTEM', 'Manager', 'Manager', 'Polling stopped.');
                stopPollBtn.disabled = true;
                startPollBtn.disabled = false;
                startPollBtn.innerText = "Start Polling";
            }
        }

        // --- Event Listeners ---
        startSimBtn.addEventListener('click', () => {
            const numDevices = parseInt(numDevicesInput.value, 10);
            const prefix = agentPrefixInput.value;
            managerIP = managerIpInput.value;
            
            // Update Manager node: white, centered, and NO pulse
            mapManager.baseClass = 'w-24 h-24 rounded-full flex flex-col items-center justify-center text-center font-bold shadow-md transition-all duration-150 bg-white text-black border-2 border-gray-400 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2';
            mapManager.className = mapManager.baseClass;
            mapManager.innerHTML = `Manager<br><span class="text-xs font-normal">${managerIP}</span>`;

            devices.clear();
            deviceGrid.innerHTML = '';
            mapAgentsContainer.innerHTML = ''; // Clear map agents
            stopPolling();

            if (isNaN(numDevices) || numDevices <= 0 || numDevices > 100) {
                logMessage('SYSTEM', 'Manager', 'Manager', 'Error: Invalid number of devices (1-100).');
                return;
            }

            for (let i = 1; i <= numDevices; i++) {
                const ip = `${prefix}${100 + i}`;
                const type = i % 2 === 0 ? 'Switch' : 'Router';
                const device = new Device(ip, type);
                devices.set(ip, device);
                
                // Update both UI sections
                updateDeviceGrid(device);
                // Pass index (i-1) and total (numDevices) for circular layout
                updateNetworkMap(device, i - 1, numDevices); 
            }
            
            logMessage('SYSTEM', 'Manager', 'Manager', `Created ${numDevices} devices.`);
            startPollBtn.disabled = false;
            sendSetBtn.disabled = false;
        });

        startPollBtn.addEventListener('click', startPolling);
        stopPollBtn.addEventListener('click', stopPolling);
        
        sendSetBtn.addEventListener('click', () => {
            const ip = setIpInput.value;
            const oid = setOidInput.value;
            const value = setValueInput.value;
            const device = devices.get(ip);

            if (!device) {
                logMessage('SYSTEM', 'Manager', 'Manager', `Error: Device with IP ${ip} not found.`);
                return;
            }
            if (!oid || !value) {
                logMessage('SYSTEM', 'Manager', 'Manager', 'Error: OID and Value must be specified for SET.');
                return;
            }
            
            const delay = getNetworkDelay();
            logMessage('SET', managerIP, ip, `Request: ${oid} = ${value}`);
            flashMapElement(ip, 'set'); // Animate map

            setTimeout(() => {
                const response = device.set(oid, value);
                logMessage('SET-RESPONSE', ip, managerIP, `Response: ${response}`);
            }, delay);
        });

        clearLogBtn.addEventListener('click', () => {
            logOutput.innerHTML = '';
            logMessage('SYSTEM', 'Manager', 'Manager', 'Log cleared.'); // Add feedback
        });

    </script>
</body>
</html>

